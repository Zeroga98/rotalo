<offer-modal *ngIf="isOfferModalShowed" [config]="configModal" (close)="isOfferModalShowed = false"></offer-modal>
<modal-buy-info [statusProduct]="products.status" [idProduct]="products.id" *ngIf="isModalBuyShowed" (closeModal)="showMessageModal($event)"></modal-buy-info>
<custom-spinner *ngIf="!products"></custom-spinner>
<div *ngIf="products" class="container">
  <modal-send-message [idProduct]="products.id" *ngIf="isModalSendMessageShowed" [idUserProduct]="products.user.id" [conversationDefault]="conversation"
    (close)="isModalSendMessageShowed = false"></modal-send-message>
  <div class="product">
    <div *ngIf="!products?.photos" class="product-photos">
      <div *ngIf="isSellProcess()" class="lable-sell-process">
        <div class="icon-clock label-sell--center"></div>
        <label class="label-sell--center">Venta en proceso</label>
      </div>
      <div class="panel-heading">
        <div class="container-product__image">
          <img src="/assets/img/product-no-image.png">
        </div>
      </div>
    </div>
    <div *ngIf="products?.photos" class="product-photos">
      <div *ngIf="isSellProcess()" class="lable-sell-process">
        <div class="icon-clock label-sell--center"></div>
        <label class="label-sell--center">Venta en proceso</label>
      </div>
      <div [ngClass]="isSellProcess() ? 'deactivated-photo' : ''" class="panel-heading">
        <ngx-carousel [inputs]="carouselConfig">
          <ngx-item NgxCarouselItem *ngFor="let productImage of productsPhotos">
            <div class="container-product__image">
              <img src="{{productImage?.url}}">
            </div>
          </ngx-item>
          <span (click)="clickArrow()" NgxCarouselPrev class="gtmFlechasProductos carousel-arrow carousel-arrow__prev">
            <span class="icon icon-chevron-thin-left"></span>
          </span>
          <span (click)="clickArrow()" NgxCarouselNext class="gtmFlechasProductos carousel-arrow carousel-arrow__next">
            <span class="icon icon-chevron-thin-right"></span>
          </span>
        </ngx-carousel>
      </div>
    </div>

    <div *ngIf="products" class="product-info">
      <div class="title-product">{{products.name}}</div>
      <div class="valor-product">{{products.price | currency:"$":0 | removeDigits }} {{ products.currency }}</div>
      <div class="capitalize">{{products['sell-type'].toLowerCase()}}</div>
      <div *ngIf="products.subcategory" class="contTipo">
        <strong>{{products.subcategory.category.name}} -</strong> {{products.subcategory.name}}</div>
      <div class="description">{{products.description}}</div>
      <div class="product-info-ubicacion">
        <div>
          <span class="icon icon-calendar"></span>
          <strong>Fecha de Publicación: </strong>
          <span>{{products['published-at'] | amTimeAgo}}</span>
        </div>
        <span class="icon icon-location"></span>
        <span>{{getLocation(products)}}</span>
      </div>
      <div class="product-info-estado">
        <span class="condition">Condición: </span>
        <span>{{products.used ? 'Usado' : 'Nuevo'}}</span>
      </div>
      <div class="product-info-user">
        <div>
          <div class="media-middle">
            <div *ngIf="!products.user.photo" class="product-info-user--icon"  [ngStyle]="{'background-color':products.user.company.colour}">
              <span class="icon-account" ></span>
            </div>
            <div *ngIf="products.user.photo" class="photo-user">
              <img [src]="products.user.photo.url">
            </div>
          </div>

          <div *ngIf="products.user.company" class="media-middle product-info-user--data">
            <p class="name-user">{{products.user.name}}</p>
            <p class="panel-product"[ngStyle]="{'color':products.user.company.colour}">{{products.user.company.name}} -
              <span [ngStyle]="{'color':products.user.company.colour}">{{products.user.company.community.name}}</span>
            </p>
          </div>
        </div>
        <div class="product-btn" *ngIf="!validateSession()">
          <div class="product-btns">
            <div class="cont-botons">
              <div class="gtmEnviarMensaje botons" (click)="sendMessage()">
                <span class="icon icon-custom icon-custom--mail"></span>
                Enviar Mensaje
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="product-btn" *ngIf="!readOnly">
      <div class="product-btns">
        <div class="info-center" *ngIf="isSellProcess() && !validateSession()">
          <label>Producto en proceso de venta</label>
        </div>
        <div class="cont-botons" *ngIf="!isSellProcess() && !validateSession()">
          <button class="gtmProdSufiTePresta botons" *ngIf="products && products['sell-type'] !== 'SUBASTA' && checkSufiBotton()" (click)="openSimulateCreditSufi(products.id)">
            <span class="icon-custom icon-custom--sufi-logo"></span>Solicitar crédito
          </button>
          <button class="gtmProdHacerOferta botons" *ngIf="products && products.negotiable" (click)="openOfferModal(products)">
            <span class="icon-offer"></span> Hacer oferta
          </button>
          <button class="gtmProdComprar botons" *ngIf="products && products['sell-type'] !== 'SUBASTA'" (click)="buyProduct(products.id)">
            <span class="icon-shop_car"></span> {{ products['sell-type'] === 'GRATIS' ? 'Yo lo quiero' : 'Comprar' }}
          </button>
        </div>
        <div  *ngIf="!isSellProcess() && !validateSession()" class="share-product-container">
            <a (click)="showInputShare=true" class="share-product">Compartir este producto</a>
            <div *ngIf="showInputShare" class="input-container">
              <form  (ngSubmit)="shareProduct()" [formGroup]="sendInfoProduct" class="form-theme">
                  <div class="form-group">
                      <input (click)="messageSuccess=false" [ngClass]="{'invalid': sendInfoProduct.get('email').invalid && !sendInfoProduct.get('email').pristine}" formControlName="email"
                      maxlength="100" id="txt-email" type="email" class="form-control"  placeholder="Escribe aquí el correo de tu amigo">
                      <div class="icon-container">
                        <button class="button-share" type="submit">
                            <div class="icon-email"></div>
                        </button>
                      </div>
                  </div>
                  <span  *ngIf="sendInfoProduct.get('email').invalid && !sendInfoProduct.get('email').pristine" class="help-block">
                      <span>
                        El campo no cumple con el formato de correo.
                      </span>
                  </span>
                  <span *ngIf="messageSuccess" class="help-block success-text">
                      <span>
                          ¡Hemos enviado el correo con éxito!
                      </span>
                  </span>
              </form>
            </div>
        </div>
        <div class="media" *ngIf="validateSession() && !isSold()">
          <div class="media-left media-middle">
            <label class="switch">
              <input type="checkbox" [checked]="productStatus" (change)="saveCheck()">
              <div class="switch-slider round"></div>
            </label>
          </div>
          <div class="media-body">
            <p class="panel-product__info post-status {{productChecked}}">Tu aviso está {{ productStatus ? 'activo' : 'inactivo' }}</p>
          </div>
        </div>
      </div>
      <div class="product-btns" *ngIf="validateSession() && !isSold()">
        <div class="cont-botons">
          <div class="botons" (click)="editProduct(products)">
            <span class="icon icon-edit"></span>
            Editar
          </div>
          <div class="botons" (click)="deleteProduct(products)">
            <span class="icon icon-trash"></span>
            Eliminar
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
